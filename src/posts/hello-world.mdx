Заголовок: "Привет, мир: как я создал этот сайт"
Аннотация: Изначально я создал этот сайт портфолио в 2018 году, и с тех пор он претерпел значительные изменения. Недавно я перешел с Create React App на Next.js и в процессе внес некоторые крупные улучшения.

Дата: '2022-04-21'
Баннер: /static/hello-world-banner.jpg

## Как всё начиналось
В 2018 году мне потребовалось обновить свой сайт портфолио (как это привычно для дизайнеров). Я решил отойти от текущих трендов и создать сайт, который бы вдохновлялся эстетикой киберпанка 80-х и 90-х годов. Этот жанр включает в себя некоторые из моих любимых фильмов, таких как "Призрак в доспехах" (1995), "Матрица" (1999) и "Акира" (1988). Именно здесь я заимствовал несколько визуальных мотивов, таких как жирное катакана на главной странице и эффект декодирования текста в виде дань "Цифровому дождю" из "Матрицы", который сам был вдохновлен заставкой "Призрака в доспехах". Даже на моей странице 404 есть намек на "Призрака в доспехах".

!Сцена из "Призрака в доспехах" (1995) с Мейджор в термотактическом камуфляже; постер "Акиры"; эффект цифрового дождя из "Матрицы"](/static/inspiration.png)

## Первая итерация
Когда я впервые создавал этот веб-сайт, я изучал React, и хотя это было избыточно для персонального сайта портфолио, это была отличная возможность научиться и экспериментировать. Я обнаружил, что лучший способ научиться - это создать что-то, что вы намерены использовать и выпустить в продакшн.

Логичным выбором тогда был Create React App. Он отлично подходил для быстрого запуска без необходимости настройки. Кроме того, я использовал Styled Components, Tween.js и React Transition Group. Я также экспериментировал с некоторыми эффектами Three.js, такими как сфера смещения, которая до сих пор присутствует на главной странице.

С тех пор я использовал этот веб-сайт как площадку для экспериментов с новыми технологиями и методиками, поэтому со временем я переделал практически все. Большим изменением по пути стало замещение изображений моих работ статическими макетами на интерактивные 3D-устройства, отрисованные в реальном времени, с использованием моделей, созданных мной для плагина [Clay Mockups 3D Figma плагин](https://www.figma.com/community/plugin/819335598581469537/Clay-Mockups-3D).

![Эскиз для моего плагина Clay Mockups](/static/clay-mockups.png)

## Переход на Next.js

При использовании Create React App я использовал довольно "костыльный" и необслуживаемый пакет для предварительной отрисовки сайта в виде статического HTML с использованием Puppeteer. Это в целом работало нормально, но мне требовалось более надежное решение для публикации статей (таких, как та, которую вы читаете), используя MDX. У меня была наполовину готовая версия этого, заложенная в репозитории, но она никогда не казалась достаточно хорошей для публикации. Я рассматривал несколько вариантов, таких как Gatsby, Vite, Parcel и Remix, но Next.js выделялся как наилучшее подходящий для моих нужд.

Теперь сайт основан на Next.js, что гораздо лучше подходит, чем Create React App. Пока что я использую его только для создания статического экспорта, но, возможно, в будущем добавлю некоторые вещи с серверной отрисовкой.
Теперь для стилизации используется чистый CSS с postcss для поддержки будущих возможностей вложенности стилей и пользовательских медиазапросов. Я использую CSS-модули вместо синтаксиса BEM, чтобы избежать конфликтов стилей.
Для создания страниц из файлов `.mdx` я использую [mdx-bundler](https://github.com/kentcdodds/mdx-bundler). от Кента Си Доддса. В сочетании с Next.js это делает создание страниц из файлов `.mdx` быстрым и простым.
Для анимации я перешел от Tween.js и React Transition Group к Framer Motion.
3D-эффекты все еще создаются с использованием Three.js, но я добавил `three-stdlib` в качестве лучшего поддерживаемого заменителя для модулей из примеров Three.

## Не все гладко


В целом миграция прошла достаточно прямолинейно. Способ, которым я организовал структуру сайта с использованием React Router, отлично подходил для соответствия файловой маршрутизации Next.js, и я уже использовал postcss для стилизации. Однако возникли некоторые проблемы:

### 1. Переходы между маршрутами

Возникли некоторые конфликты при анимированных переходах между маршрутами. При переходе на новую страницу Next.js мгновенно убирает все стили предыдущей страницы. Это хорошо работает, когда вы не выполняете анимацию между страницами, потому что это убирает любые неиспользуемые стили, которые могли остаться. Однако, когда вы анимируете переход страницы, внезапно предыдущая страница становится явно без стилей при исчезновении. Эта проблема является одной из [самых обсуждаемых и комментируемых проблем](https://github.com/vercel/next.js/issues/17464) в репозитории Next.js, так что, надеюсь, скоро появится решение. На данный момент я вставил [хак для исправления вещей](https://github.com/vercel/next.js/issues/17464#issuecomment-796430107) из комментариев к проблеме.

### 2. Восстановление прокрутки

Отчасти связано с переходами между маршрутами, мне пришлось отказаться от восстановления прокрутки как в Next.js, так и в нативном механизме браузера, чтобы предотвратить мгновенную прокрутку страницы вверх при начале перехода. Кроме того, Next.js, кажется, не обрабатывает смещение фокуса при создании ссылки на идентификатор элемента внутри страницы, поэтому я добавил это для обеспечения доступности.

## Взгляд назад и вперед

Было замечательно видеть, насколько популярен сайт на Github, с 500 звездами (на момент написания этого поста). Также интересно наблюдать, как люди адаптируют его под свой стиль и модифицируют, что является частью причины, по которой я сделал его открытым исходным кодом. Я хочу, чтобы другие могли разобраться в нем, увидеть, как он создан, учиться и улучшать его. Раньше inspect element в вебе был подобен этому, но современные сайты компилируют, минифицируют и внедряют запутанные строки в CSS-классы, что делает это не таким простым в наши дни. Следующее лучшее, что я мог сделать, — это сделать его открытым исходным кодом.

С нетерпением жду продолжения использования этого сайта как площадки для экспериментов, и будет интересно сравнить следующую итерацию с тем, где он находится сегодня.
